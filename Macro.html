<!DOCTYPE HTML><html lang=en class="sidebar-visible no-js rust"><head><meta charset=UTF-8><title>Macro - Vim Reference Guide</title><meta content="text/html; charset=utf-8"http-equiv=Content-Type><meta name=description content="Vim Reference Guide"><meta name=viewport content="width=device-width, initial-scale=1"><meta name=theme-color content=#ffffff><link rel=icon href=favicon.svg><link rel="shortcut icon"href=favicon.png><link rel=stylesheet href=css/variables.css><link rel=stylesheet href=css/general.css><link rel=stylesheet href=css/chrome.css><link rel=stylesheet href=FontAwesome/css/font-awesome.css><link rel=stylesheet href=fonts/fonts.css><link rel=stylesheet href=highlight.css><link rel=stylesheet href=tomorrow-night.css><link rel=stylesheet href=ayu-highlight.css><link rel=stylesheet href=style.css><body><script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "rust";
        </script><script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script><script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add('js');
        </script><script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script><nav id=sidebar class=sidebar aria-label="Table of contents"><div class=sidebar-scrollbox><ol class=chapter><li class="chapter-item expanded affix"><a href=cover.html>Cover</a><li class="chapter-item expanded affix"><a href=buy.html>Buy PDF/EPUB versions</a><li class="chapter-item expanded affix"><a href=preface.html>Preface</a><li class="chapter-item expanded"><a href=Introduction.html><strong aria-hidden=true>1.</strong> Introduction</a><li class="chapter-item expanded"><a href=Insert-mode.html><strong aria-hidden=true>2.</strong> Insert mode</a><li class="chapter-item expanded"><a href=Normal-mode.html><strong aria-hidden=true>3.</strong> Normal mode</a><li class="chapter-item expanded"><a href=Command-line-mode.html><strong aria-hidden=true>4.</strong> Command-line mode</a><li class="chapter-item expanded"><a href=Visual-mode.html><strong aria-hidden=true>5.</strong> Visual mode</a><li class="chapter-item expanded"><a href=Regular-Expressions.html><strong aria-hidden=true>6.</strong> Regular Expressions</a><li class="chapter-item expanded"><a href=Macro.html class=active><strong aria-hidden=true>7.</strong> Macro</a><li class="chapter-item expanded"><a href=Customizing-Vim.html><strong aria-hidden=true>8.</strong> Customizing Vim</a><li class="chapter-item expanded"><a href=CLI-options.html><strong aria-hidden=true>9.</strong> CLI options</a></li><br><hr><li class="chapter-item expanded"><i id=git-repository-button class="fa fa-github"></i><a href=https://github.com/learnbyexample/vim_reference>   Source code</a><li class="chapter-item expanded"><i id=home-button class="fa fa-home"></i><a href=https://learnbyexample.github.io/>   My Blog</a><li class="chapter-item expanded"><i id=book-button class="fa fa-book"></i><a href=https://learnbyexample.github.io/books/>   My Books</a><li class="chapter-item expanded"><i id=mail-button class="fa fa-envelope"></i><a href=https://learnbyexample.gumroad.com/l/learnbyexample-weekly>   learnbyexample weekly</a></ol></div><div id=sidebar-resize-handle class=sidebar-resize-handle></div></nav><div id=page-wrapper class=page-wrapper><div class=page><div id=menu-bar-hover-placeholder></div><div id=menu-bar class="menu-bar sticky bordered"><div class=left-buttons><button id=sidebar-toggle class=icon-button type=button title="Toggle Table of Contents"aria-label="Toggle Table of Contents"aria-controls=sidebar><i class="fa fa-bars"></i></button><button id=theme-toggle class=icon-button type=button title="Change theme"aria-label="Change theme"aria-haspopup=true aria-expanded=false aria-controls=theme-list><i class="fa fa-paint-brush"></i></button><ul id=theme-list class=theme-popup aria-label=Themes role=menu><li role=none><button role=menuitem class=theme id=light>Light</button><li role=none><button role=menuitem class=theme id=rust>Rust (default)</button><li role=none><button role=menuitem class=theme id=coal>Coal</button><li role=none><button role=menuitem class=theme id=navy>Navy</button><li role=none><button role=menuitem class=theme id=ayu>Ayu</button></ul><button id=search-toggle class=icon-button type=button title="Search. (Shortkey: s)"aria-label="Toggle Searchbar"aria-expanded=false aria-keyshortcuts=S aria-controls=searchbar><i class="fa fa-search"></i></button></div><h1 class=menu-title>Vim Reference Guide</h1><div class=right-buttons><a href=https://learnbyexample.github.io title=Blog aria-label=Blog> <i id=home-button class="fa fa-home"></i> </a><a href=https://github.com/learnbyexample/vim_reference title="Git repository"aria-label="Git repository"> <i id=git-repository-button class="fa fa-github"></i> </a></div></div><div id=search-wrapper class=hidden><form id=searchbar-outer class=searchbar-outer><input type=search id=searchbar name=searchbar placeholder="Search this book ..."aria-controls=searchresults-outer aria-describedby=searchresults-header></form><div id=searchresults-outer class="searchresults-outer hidden"><div id=searchresults-header class=searchresults-header></div><ul id=searchresults></ul></div></div><script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script><div id=content class=content><main><div class=sidetoc><nav class=pagetoc></nav></div><h1 id=macro><a class=header href=#macro>Macro</a></h1><p>The <kbd>.</kbd> repeat command repeats only the last change. And it gets overwritten with every change. The <code>q</code> command allows you to record a <em>sequence of commands</em> and execute them later whenever you need. You can make it recursive, add a count prefix, combine it with Command-line mode commands and so on. Powerful indeed!<p>With so many built-in features, sometimes it isn't easy to choose. I prefer the substitute command to macros if both of them can be used for the given problem, especially if the processing doesn't require multiple lines to be considered at once for the solution. That said, macros are more flexible, having an inherent advantage of being able to easily integrate numerous Vim commands.<p><strong>Documentation links</strong>:<ul><li><a href=https://vimhelp.org/usr_10.txt.html#10.1>:h 10.1</a> — record and playback commands<li><a href=https://vimhelp.org/repeat.txt.html#complex-repeat>:h complex-repeat</a> — reference manual for <code>q</code> and related commands</ul><h2 id=macro-usage-steps><a class=header href=#macro-usage-steps>Macro usage steps</a></h2><p>Here's a rough overview of <code>q</code> command usage. Working examples will be discussed in later sections.<ol><li>Press <kbd>q</kbd> to start the recording<li>Use any alphanumeric character as the register to store the recording (for example, <kbd>a</kbd>)<li>Add command sequence to accomplish the required editing<li>Press <kbd>q</kbd> again to stop the recording<li>Press <kbd>@a</kbd> (the register used in step 2) to execute the recorded command sequence <ul><li><kbd>5@a</kbd> execute the macro <code>5</code> times<li><kbd>@@</kbd> repeat the last executed macro</ul></ol><blockquote><p><img src=./images/info.svg alt=info> Command-line will show <code>recording @a</code> after step 2 and this indicator vanishes after step 4.</blockquote><blockquote><p><img src=./images/info.svg alt=info> Note that these registers are shared across recording, delete and yank commands. You'll see how this helps to modify a recording later, but you should also be careful not to mix them if you want separate recording and paste use cases. As mentioned earlier in Normal mode chapter, uppercase registers will append to existing content in lowercase registers.</blockquote><blockquote><p><img src=./images/info.svg alt=info> See also <a href=https://vi.stackexchange.com/q/11210/1616>vi.stackexchange: Can I repeat a macro with the "dot operator"?</a> (one of the solutions will allow you to use <kbd>.</kbd> command to execute a macro immediately after recording as well).</blockquote><h2 id=example-1><a class=header href=#example-1>Example 1</a></h2><p>The <kbd>qwceHello^[q</kbd> macro recording clears text till the end of the word and inserts <code>Hello</code>. Here's a breakdown of this command sequence:<ul><li><kbd>q</kbd> start recording<li><kbd>w</kbd> register used to save the macro<li><kbd>ce</kbd> change till the end of the word<li><kbd>Hello</kbd> insert these characters<li><kbd>^[</kbd> this is a single character that denotes the <kbd>Esc</kbd> key <ul><li>in other words, press <kbd>Esc</kbd> key for this step, <em>don't</em> type <code>^</code> and <code>[</code> characters<li>you'll see this representation if you paste the contents of <code>"w</code> register using <kbd>"wp</kbd></ul><li><kbd>q</kbd> stop recording</ul><p>After you've recorded the macro, you can execute this command sequence anywhere else you need it. For example, if the cursor is on the fourth character of the text <code>Hi-there</code> and <kbd>@w</kbd> is pressed, you'll get <code>Hi-Hello</code>.<h2 id=modifying-a-macro><a class=header href=#modifying-a-macro>Modifying a macro</a></h2><p>As mentioned earlier, registers are shared across recording, delete and yank commands. When you call a macro using <code>@</code>, the register content is treated as the sequence of commands to be executed. So, editing a register's content will automatically update the behavior of the macro as well. Knowing that you can modify a macro also helps if you make a mistake — you can choose to finish the recording and update later instead of restarting the recording.<p>Suppose you want to use <code>'Hello!'</code> instead of <code>Hello</code> for the macro discussed in the previous section. Here's one possible way to make the changes:<ul><li><kbd>"wp</kbd> paste the contents of <code>"w</code> register <ul><li>you should get <code>ceHello^[</code></ul><li><kbd>ce'Hello'!^[</kbd> modify the text as needed<li><kbd>"wy</kbd> update the contents of <code>"w</code> register after visually selecting the modified text or using motion commands</ul><p>After you've modified the register contents, check if it is working as expected. For example, if the cursor is on the fourth character of the text <code>Hi-there</code> and <kbd>@w</kbd> is pressed, you should now get <code>Hi-'Hello'!</code>.<blockquote><p><img src=./images/info.svg alt=info> In case you wish to create a new macro from scratch by just typing the required text instead of using the <code>q</code> command, you'll find <kbd>Ctrl</kbd>+<kbd>v</kbd> (or the <kbd>Ctrl</kbd>+<kbd>q</kbd> alias) useful to insert keys like <kbd>Esc</kbd> and <kbd>Enter</kbd>. To do so, press <kbd>Ctrl</kbd>+<kbd>v</kbd> followed by the required key. You'll get <code>^[</code> for <kbd>Esc</kbd>, <code>^M</code> for <kbd>Enter</kbd> and so on.</blockquote><blockquote><p><img src=./images/info.svg alt=info> <kbd>let @w = "ce'Hello'!^["</kbd> adding this line to <code>.vimrc</code> file will load the <code>"w</code> register with the given text at startup.</blockquote><h2 id=example-2><a class=header href=#example-2>Example 2</a></h2><p>Suppose you forgot to add curly braces for single statement control structures in a Perl program:<pre><code class=language-perl># syntax error
if($word eq reverse $word)
    print "$word is a palindrome\n";

# corrected code
if($word eq reverse $word)
{
    print "$word is a palindrome\n";
}
</code></pre><p><kbd>qpo{^[jo}^[q</kbd> is one way to do it:<ul><li><kbd>qp</kbd> start recording and use register <code>p</code><li><kbd>o</kbd> open a new line<li><kbd>{</kbd> insert <code>{</code> character<li><kbd>^[</kbd> go back to Normal mode (<kbd>Esc</kbd> key)<li><kbd>j</kbd> move down one line<li><kbd>o</kbd> open another line<li><kbd>}</kbd> insert <code>}</code> character<li><kbd>^[</kbd> go back to Normal mode (<kbd>Esc</kbd> key)<li><kbd>q</kbd> stop recording</ul><p>Having a macro will help you apply this correction whenever you forget braces for single statement control structures.<blockquote><p><img src=./images/info.svg alt=info> Note that <code>{</code> and <code>}</code> will be indented based on style settings for that particular filetype.</blockquote><h2 id=example-3><a class=header href=#example-3>Example 3</a></h2><p>I used <kbd>F`r[f`s]()^["*P</kbd> macro to replace <code>`:h &LTtopic>`</code> with a hyperlink to the corresponding online help page for this ebook. Assume the cursor is somewhere within the <code>:h &LTtopic></code> text portion surrounded by backticks (markdown formatting for inline code). This has to be changed to <code>[:h &LTtopic>](link)</code> (markdown formatting for hyperlinks).<ul><li><kbd>F`</kbd> move cursor to the starting backtick<li><kbd>r[</kbd> replace backtick with <code>[</code><li><kbd>f`</kbd> move cursor to the ending backtick<li><kbd>s]()</kbd> replace backtick with <code>]()</code><li><kbd>^[</kbd> go back to Normal mode (<kbd>Esc</kbd> key)<li><kbd>"*P</kbd> paste contents of the last highlighted text selection <ul><li>note the use of uppercase <code>P</code> to paste content to the left of the cursor</ul></ul><p>Once the macro was recorded, I just had to select the url from the browser for each help topic and execute the macro. I used <kbd>n</kbd> to navigate in the markdown files after using <code>:h </code> as the search pattern.<h2 id=motion-and-filter><a class=header href=#motion-and-filter>Motion and Filter</a></h2><p>If you have to apply the same macro for text portions that are next to each other, you can add motion commands at the end of the macro for reaching the next text portion. The motion command could be arrow motions, searching using <code>/</code> and so on. Doing so will allow you to use a count prefix to apply the macro for all the text portions in one shot. This assumes that you can easily count the number of text portions. For example, consider this Python snippet where you want to change single line definitions to multiple lines:<pre><code class=language-python>def square(n): return n ** 2
def cube(n): return n ** 3
def isodd(n): return n % 2 == 1
</code></pre><p>You can do a recording as usual, select these lines visually (or use a range) and then apply the macro using <kbd>normal @d</kbd> in Command-line mode. Or, you could add a motion to automatically go to the next line and use a count prefix as described below.<p><kbd>qd0f:lr^M>>o^[jq</kbd> is one way to achieve this:<ul><li><kbd>0f:l</kbd> Move to beginning of the line and then move the cursor to the character after the first occurrence of <code>:</code> (which is a space character in the above snippet) <ul><li>this also assumes that there won't be any <code>:</code> character as part of the function arguments</ul><li><kbd>r^M</kbd> replace the space character with newline character<li><kbd>>></kbd> indent the line<li><kbd>o^[</kbd> open a new line and go back to Normal mode<li><kbd>j</kbd> move to the next line (this makes it possible to use the count prefix)</ul><p>After recording, you can use <kbd>3@d</kbd> on the first line to get the output as shown below:<pre><code class=language-python>def square(n):
    return n ** 2

def cube(n):
    return n ** 3

def isodd(n):
    return n % 2 == 1

</code></pre><p>Suppose the Python function definitions discussed above aren't next to each other but can be found anywhere in the Python script file. In such cases, if you are able to reliably identify the lines using a regexp filter, you can use the <code>:g</code> command.<ul><li><kbd>qdf:lr^M>>oq</kbd> simplified macro <ul><li><code>0</code> not required since the cursor starts at the beginning<li>no need to return to Normal mode after opening a new line<li>no need to move to the next line</ul><li><kbd>:g/^def.*): / normal @d</kbd> apply the macro for filtered lines<li><kbd>:%s/^def.*):\zs \(.*\)/\r\t\1\r/</kbd> if you are comfortable with regexp, you could also just use the substitution command like this one instead</ul><h2 id=recursive-recording><a class=header href=#recursive-recording>Recursive recording</a></h2><p>Suppose it isn't easy to count the number of text portions and filtering is complicated too. In such cases, you might be able to use recursive recording that continues to execute the macro until one of the steps fails. Similar to recursive function calls, you have to call the macro from within the recording. Consider this Python snippet where you want to change single line definitions to multiple lines:<pre><code class=language-python>def square(n): return n ** 2
def cube(n): return n ** 3
def isodd(n): return n % 2 == 1
print(square(12))
</code></pre><p><kbd>qr0f:lr^M>>o^[j@rq</kbd> is one way to achieve this. The only addition here is <code>@r</code> at the end of the recording compared to the solution discussed in the previous section. For the fourth line with <code>print()</code> function, the macro will stop when it doesn't find the <code>:</code> character. It would've stopped even if a <code>:</code> was found, provided it was the last character, since the <code>l</code> motion would've failed.<p>Using <code>@r</code> on the first line of the above snippet would give the following output:<pre><code class=language-python>def square(n):
    return n ** 2

def cube(n):
    return n ** 3

def isodd(n):
    return n % 2 == 1

print(square(12))
</code></pre><blockquote><p><img src=./images/warning.svg alt=warning> <img src=./images/info.svg alt=info> Note that the register being used here must be empty before you start the recording, otherwise you might see some unwanted changes when you type <code>@r</code> while recording. To ensure this register is empty, you can use <kbd>qrq</kbd> (i.e. record an empty macro) before you record the recursive macro.</blockquote><blockquote><p><img src=./images/info.svg alt=info> If the <code>:s</code> command is part of the recording and you do not want the macro to stop if the search pattern isn't found, you can use the <code>e</code> flag.</blockquote><p>Here are some more examples:<ul><li><a href=https://vi.stackexchange.com/q/6426/1616>vi.stackexchange: How do I stop a recursive macro at the end of the line?</a> — one of the examples shows how to incorporate Vimscript, so you get full programming capabilities like variables, <code>if</code> control structure and so on<li><a href=https://vi.stackexchange.com/a/6290/1616>vi.stackexchange: How to reverse every 4 lines?</a><li><a href=https://vi.stackexchange.com/q/482/1616>vi.stackexchange: Correct all spelling mistakes in the document</a></ul><h2 id=exercise><a class=header href=#exercise>Exercise</a></h2><p>Given the following text:<pre><code class=language-md># Introduction
# Normal mode
# Command Line mode
# Visual mode
</code></pre><p>Use a macro (or substitute command if you prefer) to get the modified text as shown below:<pre><code class=language-md>* [Introduction](#introduction)
* [Normal mode](#normal-mode)
* [Command Line mode](#command-line-mode)
* [Visual mode](#visual-mode)
</code></pre><h2 id=further-reading><a class=header href=#further-reading>Further Reading</a></h2><ul><li><a href=https://blog.sanctum.geek.nz/advanced-vim-macros/>Advanced vim macros</a><li><a href=https://vi.stackexchange.com/questions/tagged/macro?tab=Votes>vi.stackexchange: top Q&A on macro</a></ul></main><nav class=nav-wrapper aria-label="Page navigation"><a rel=prev href=Regular-Expressions.html class="mobile-nav-chapters previous"title="Previous chapter"aria-label="Previous chapter"aria-keyshortcuts=Left> <i class="fa fa-angle-left"></i> </a><a rel=next href=Customizing-Vim.html class="mobile-nav-chapters next"title="Next chapter"aria-label="Next chapter"aria-keyshortcuts=Right> <i class="fa fa-angle-right"></i> </a><div style="clear: both"></div></nav></div></div><nav class=nav-wide-wrapper aria-label="Page navigation"><a rel=prev href=Regular-Expressions.html class="nav-chapters previous"title="Previous chapter"aria-label="Previous chapter"aria-keyshortcuts=Left> <i class="fa fa-angle-left"></i> </a><a rel=next href=Customizing-Vim.html class="nav-chapters next"title="Next chapter"aria-label="Next chapter"aria-keyshortcuts=Right> <i class="fa fa-angle-right"></i> </a></nav></div><script>
            window.playground_copyable = true;
        </script><script src=elasticlunr.min.js charset=utf-8></script><script src=mark.min.js charset=utf-8></script><script src=searcher.js charset=utf-8></script><script src=clipboard.min.js charset=utf-8></script><script src=highlight.js charset=utf-8></script><script src=book.js charset=utf-8></script><script src=sidebar.js></script>